!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(this,function(){"use strict";function e(e,t){for(var n in t)e[n]=t[n];return e}function t(e,t){return t=document||t,t.querySelectorAll(e)}function n(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function r(e){var t,n,r=e.replace(/^(https?:)?\/\//,""),o=r.indexOf("/"),i=r.slice(0,o).replace(/:\d+$/,""),a=r.slice(o);if(a.indexOf("?")>=0){var u=a.split("?"),s=E(u,2);t=s[0],n=s[1]}else t=a,n="";var c;return c=null!=i.match(/:\d+/)?i.match(/:(\d+)/)[1]:"80",{host:i,urlPath:t,port:c,search:n}}function o(e){return Math.round(1e3*e)/1e3}function i(e){return e.match(/^https?:/)?e:""+location.protocol+e}function a(e){k=e}function u(e){x=e}function s(e,t){var n={id:L.location.href,sdkVer:b,appVer:k,type:e,d:t};if("function"==typeof L.PERF_DEBUG)L.PERF_DEBUG(n);else{var r=new Image;r.src=x+"/_.gif?"+T(n)+("&time="+Date.now())}return this}function c(e,t){var n={};if("string"==typeof e)n={line:"0:0",file:t.toString(),error:e};else if("object"===("undefined"==typeof e?"undefined":g(e)))if(e.sourceURL)n={line:e.line+":"+e.column,file:e.sourceURL,error:e.message};else if(e.stack){for(var r=e.stack.split("\n"),o=e.toString(),i=/(https?:\/\/.*?):(\d*):(\d*)/,a=void 0,u=0,s=r.length;u<s;++u){var c=r[u];if(i.test(c)){a=i.exec(c);break}}n=a&&a.length>3?{line:a[2]+":"+a[3],file:a[1],error:o}:{line:"0:0",file:r.toString(),error:o}}return n}function d(e,t){try{"function"!=typeof e&&(e=new Function(e)),e.apply(null,t)}catch(t){var n=c(t,e),r=JSON.stringify(n);if(C[r])return;throw C[r]=!0,s("error",n),t}}function f(){q.addEventListener("error",function(e){var t=e.filename+e.lineno+e.colno+q.location.href;C[t]||(C[t]=!0,s("error",{line:e.lineno+":"+e.colno,file:e.filename,error:e.message}))}),q.addEventListener("unhandledrejection",function(e){var t="Unhandled promise rejection: "+e.reason;s("error",{error:t})});var e=q.setTimeout;q.setTimeout=function(t,n){var r=[].slice.call(arguments,2);return e(function(){d(t,r)},n)};var t=q.setInterval;q.setInterval=function(e,n){var r=[].slice.call(arguments,2);return t(function(){d(e,r)},n)}}function p(){function e(){var e=[["lookup",["domainLookupEnd","domainLookupStart"]],["connect",["connectEnd","connectStart"]],["waiting",["responseStart","requestStart"]],["receiving",["responseEnd","responseStart"]],["parsing",["domComplete","domLoading"]],["contentLoaded",["domContentLoadedEventStart","navigationStart"]],["pageLoaded",["loadEventStart","navigationStart"]]],t={};return e.forEach(function(e){var n=E(e[1],2),o=n[0],i=n[1];t[e[0]]=r.performance.timing[o]-r.performance.timing[i]}),t}function t(){o||(o=1,s("load",e()))}function n(){o||(o=1,s("unload",e()))}var r=window,o=0;r.performance&&(r.addEventListener("beforeunload",n),r.addEventListener("load",t))}function l(e){var t=e.type,n={},r={id:this.getAttribute("perf-"+t),event:t};if(!r.id){if(D.PERF_DEBUG)throw new Error(S.id(t));return console.log(S.id(t))}this.getAttribute("perf-route")&&(r.route=this.getAttribute("perf-route"));var o=null;if(this.getAttribute("perf-data")){n=this.getAttribute("perf-data");try{n=JSON.parse(n)}catch(e){if(o=1,D.PERF_DEBUG)throw new Error(S.data);console.log(o)}}o||s({data:n,event:r})}function h(){["click","contextmenu","dblclick","mousedown","mouseenter","mouseleave","mousemove","mouseover","mouseout","mouseup","keydown","keypress","keyup","abort","beforeunload","error","hashchange","load","pageshow","pagehide","resize","scroll","unload","blur","change","focus","focusin","focusout","input","invalid","reset","search","select","submit","drag","dragend","dragenter","dragleave","dragover","dragstart","drop","copy","cut","paste","afterprint","beforeprint","abort","canplay","canplaythrough","durationchange","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting","animationend","animationiteration","animationstart","transitionend"].forEach(function(e){var n=t("[perf-"+e+"]");n.length&&[].slice.call(n).forEach(function(t){return t.addEventListener(e,l)})})}function v(){D.addEventListener("load",h)}function m(e,t){return t={exports:{}},e(t,t.exports),t.exports}function y(){window.addEventListener("load",function(){null!=window.performance&&null!=performance.getEntries&&M()})}function w(e){if(R.when(/^/,e,j,U),null!=window.fetch){var t=window.Headers.toString()===B;t&&A.when(/^/,e,O,N)}}var g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E=(function(){function e(e){this.value=e}function t(t){function n(e,t){return new Promise(function(n,o){var u={key:e,arg:t,resolve:n,reject:o,next:null};a?a=a.next=u:(i=a=u,r(e,t))})}function r(n,i){try{var a=t[n](i),u=a.value;u instanceof e?Promise.resolve(u.value).then(function(e){r("next",e)},function(e){r("throw",e)}):o(a.done?"return":"normal",a.value)}catch(e){o("throw",e)}}function o(e,t){switch(e){case"return":i.resolve({value:t,done:!0});break;case"throw":i.reject(t);break;default:i.resolve({value:t,done:!1})}i=i.next,i?r(i.key,i.arg):a=null}var i,a;this._invoke=n,"function"!=typeof t.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)},{wrap:function(e){return function(){return new t(e.apply(this,arguments))}},await:function(t){return new e(t)}}}(),function(){function e(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()),T=function e(t,n){var r,o=[];for(r in t){var i=t[r];if(t.hasOwnProperty(r)&&null!=i){var a=n?n+"["+r+"]":r;o.push(null!==i&&"object"===("undefined"==typeof i?"undefined":g(i))?e(i,a):encodeURIComponent(a)+"="+encodeURIComponent(i))}}return o.join("&")},S={id:function(e){return'You need a "project/id", like perf-'+e+'="project/id"'},data:"`perf-data` show be a json string"},b="1.1.3",L=window,x="https://perf.ele.me",k=null,C={},q=window,D=window,R=m(function(e){void function(t){return"object"==typeof e&&e.exports?t(function(t,n,r){void 0===r&&(r=n,n=[]);var o;o=[],e.exports=r.apply(e.exports,o)||e.exports}):"function"===String(typeof define)&&define.amd?t(define):void t(function(e,t,n){void 0===n&&(n=t,t=[]);try{"object"==typeof execScript&&execScript("var "+e)}catch(e){}window[e]={};for(var r=[],o=0;o<t.length;o++)r[o]=window[t[o]];window[e]=n.apply(window[e],r)||window[e]})}(function(e){e("XCeptor",function(){if(XMLHttpRequest.XCeptor)return XMLHttpRequest.XCeptor;var e=XMLHttpRequest,t=function(){};t.check=function(e,t){return null==e||e===t||("function"==typeof e.test?e.test(t):"function"==typeof e?e(t):void 0)},t.prototype=[],t.prototype.solve=function(e,t,n){var r=this,o=function(i){var a=function(e){switch(!0){case e===!0:return t&&t();case e===!1:return n&&n();case e&&"function"==typeof e.then:return e.then(a,function(e){throw e});default:o(i+1)}};i<r.length?a(r[i].apply(null,e)):t&&t()};o(0)},t.prototype.add=function(e,n,r){"function"==typeof e&&this.push(function(o,i){if(t.check(n,o.method)&&t.check(r,o.url))return e(o,i)})};var n,r=new t,o=new t;void function(){var e=["readyState","timeout","withCredentials","status","statusText","responseURL","responseType","response","responseText","responseXML"];n=function(t,n,r){for(var o,i=0;o=e[i];i++)if(!r||r.test(o)){try{void n[o],void t[o]}catch(e){continue}n[o]=t[o]}}}();var i=function(e,t){this.type=e,this.target=t},a=function(e){var t="__events__",n=function(e,n){var r=t in e?e[t]:e[t]={};return n in r?r[n]:r[n]=[]},r=function(e,t){n(this,e).push(t)},o=function(e,t){for(var r=n(this,e),o=0;o<r.length;o++)r[o]===t&&(r.splice(o,1),o=NaN)},i=function(e){for(var t=n(this,e.type),r=0;r<t.length;r++)t[r](e);var o="on"+e.type;"function"==typeof this[o]&&this[o](e)},a=function(){e.apply(this,arguments),this.addEventListener=r,this.removeEventListener=o,this.dispatchEvent=i};return a.prototype=e.prototype,a};return window.XMLHttpRequest=function(){var t=new e,a=this;n(t,a);var u={method:null,url:null,isAsync:!0,username:void 0,password:void 0,headers:[],overridedMimeType:void 0,timeout:a.timeout,withCredentials:a.withCredentials,responseType:""},s={status:a.status,statusText:a.statusText,headers:[]};a.open=function(e,t,n,r,o){u.method=(e+"").toUpperCase(),u.url=t+"",void 0!==n&&(u.isAsync=!!(1*n)),void 0!==r&&(u.username=r+""),void 0!==o&&(u.password=o+"")},a.setRequestHeader=function(e,t){u.headers.push({header:e+"",value:t+""})},a.overrideMimeType=function(e){u.overridedMimeType=e},a.getResponseHeader=function(e){var t=s.headers;e=String(e).toLowerCase();for(var n=0;n<t.length;n++)if(t[n].header.toLowerCase()===e)return t[n].value;return null},a.getAllResponseHeaders=function(){for(var e=s.headers,t=[],n=0;n<s.headers.length;n++)t.push(e[n].header+": "+e[n].value);return t.join("\r\n")},a.send=function(e){u.data=e,u.withCredentials=a.withCredentials,u.timeout=a.timeout,u.responseType=a.responseType,r.solve([u,s],function(){t.open(u.method,u.url,u.isAsync,u.username,u.password);for(var e=0;e<u.headers.length;e++)t.setRequestHeader(u.headers[e].header,u.headers[e].value);void 0!==u.overridedMimeType&&t.overrideMimeType(u.overridedMimeType),t.withCredentials!==u.withCredentials&&(t.withCredentials=u.withCredentials),t.timeout!==u.timeout&&(t.timeout=u.timeout),t.responseType!==u.responseType&&(t.responseType=u.responseType),t.send(u.data)},function(){var e=function(){s.readyState=3,n(s,a),c("readystatechange"),s.readyState=4,n(s,a),f(),c("readystatechange"),c("load")};u.isAsync?setTimeout(e):e()})},a.abort=function(){t.abort()};var c=function(e){a.dispatchEvent(new i(e,a))},d=function(){d.disabled||(d.disabled=!0,s.headers.splice(0,s.headers.length),s.status=t.status,s.statusText=t.statusText,t.getAllResponseHeaders().replace(/.+/g,function(e){var t=e.match(/(^.*?): (.*$)/);t&&s.headers.push({header:t[1],value:t[2]})}))},f=function(){o.solve([u,s],function(){n(s,a)})};n(t,s,/^response/),void function(){t.onreadystatechange=function(){n(t,a),n(t,s),3===t.readyState&&d(),4===t.readyState&&(d(),f(),setTimeout(function(){c("load")})),c("readystatechange")};for(var e=["error","timeout"],r=function(e){t["on"+e]=function(){a.readyState=t.readyState,c(e)}},o=0;o<e.length;o++)r(e[o])}()},XMLHttpRequest.prototype={DONE:4,HEADERS_RECEIVED:2,LOADING:3,OPENED:1,UNSENT:0},XMLHttpRequest=a(XMLHttpRequest),XMLHttpRequest.XCeptor=new function(){var e=this;this.when=function(e,t,n,i){r.add(n,e,t),o.add(i,e,t)},void function(){for(var t=["GET","POST","PUT","DELETE","PATCH","HEADER","OPTIONS"],n=0;n<t.length;n++)void function(t){e[t.toLowerCase()]=function(){var n=Array.prototype.slice.call(arguments);return e.when.apply(e,[t].concat(n))}}(t[n])}()}})})}),A=m(function(e){void function(t){return"object"==typeof e&&e.exports?t(function(t,n,r){void 0===r&&(r=n,n=[]);var o;o=[],e.exports=r.apply(e.exports,o)||e.exports}):"function"===String(typeof define)&&define.amd?t(define):void t(function(e,t,n){void 0===n&&(n=t,t=[]);try{"object"==typeof execScript&&execScript("var "+e)}catch(e){}window[e]={};for(var r=[],o=0;o<t.length;o++)r[o]=window[t[o]];window[e]=n.apply(window[e],r)||window[e]})}(function(e){e("FCeptor",function(){var e=window.fetch||function(){};if(e.FCeptor)return e.FCeptor;var t=function(){};t.check=function(e,t){return null==e||e===t||("function"==typeof e.test?e.test(t):"function"==typeof e?e(t):void 0)},t.prototype=[],t.prototype.solve=function(e){var t=this;return new Promise(function(n,r){var o=function(i){var a=function(e){switch(!0){case e===!0:return n();case e===!1:return r();case e&&"function"==typeof e.then:return e.then(a,function(e){throw e});default:o(i+1)}};i<t.length?a(t[i](e)):n()};o(0)})},t.prototype.add=function(e,n,r){"function"==typeof e&&this.push(function(o){if(t.check(n,o.request.method)&&t.check(r,o.request.url))return e(o)})};var n=new t,r=new t,o=e;e=function(e,t){var i=new Request(e,t),a={request:i,response:null};return n.solve(a).then(function(){return o(a.request).then(function(e){a.response=e},function(e){a.error=e})},function(){a.response||(a.response=new Response)}).then(function(){return r.solve(a)}).then(function(){if(a.response)return a.response;throw a.error},function(){return new Promise(function(){})})},window.fetch&&(window.fetch=e);var i=new function(){var e=this;this.when=function(e,t,o,i){n.add(o,e,t),r.add(i,e,t)},void function(){for(var t=["GET","POST","PUT","DELETE","PATCH","HEAD"],n=0;n<t.length;n++)void function(t){e[t.toLowerCase()]=function(){var n=Array.prototype.slice.call(arguments);return e.when.apply(e,[t].concat(n))}}(t[n])}()};return e.FCeptor=i})})}),P=function(){var e,t=navigator.connection||navigator.mozConnection||navigator.webkitConnection;e=null!=t?t.type:"guessWifi";var n={solution:"ajax",network:e};return n},_=function(e){var t=performance.timing.navigationStart+e.startTime;return{duration:o(e.duration),beginTime:o(t),dnsSTime:o(e.domainLookupStart),dnsETime:o(e.domainLookupEnd),tcpSTime:o(e.connectStart),tcpETime:o(e.connectEnd),reqSTime:o(e.requestStart),reqETime:o(e.responseEnd),respSTime:o(e.responseStart),respETime:o(e.responseEnd),completeTime:o(e.responseEnd)}},I=function(t){var n=P();e(n,{solution:"timing"});var o=r(t.name),i=o.port,a=o.host,u=o.urlPath,s={statusCode:200,reqLength:void 0,respLength:void 0,httpMethod:"GET",url:t.name,host:a,port:i,urlPath:u,error:!1,errorDomain:void 0,errorDescription:void 0,elapsedTime:void 0};return e(n,s),n},M=function(){var t=performance.getEntries().filter(function(e){return"script"===e.initiatorType||"css"===e.initiatorType}).map(function(t){return e(I(t),_(t))});s("networkBatched",t)},H=function(){return null!=window.performance&&null!=performance.now?performance.now():(new Date).valueOf()},j=function(e){e._startedTime=H();var t=n()+"|"+(new Date).valueOf();e._requestId=t;try{e.headers.push({header:"X-Eleme-RequestID",value:t})}catch(e){}},O=function(e){var t=e.request;t._startedTime=H();var r=n()+"|"+(new Date).valueOf();t._requestId=r;try{t.headers.append("X-Eleme-RequestID",r)}catch(e){}},F=function(t){var n=P();if(e(n,t),null!=window.performance&&null!=performance.getEntriesByName){var r=performance.getEntriesByName(i(t.url)),o=r[r.length-1];null!=o&&(e(n,_(o)),e(n,{solution:"ajax timing"}))}s("network",n)},X=function(e){if("text"!==e.responseType&&""!==e.responseType)return"blob"===e.responseType?e.response.size:-1;var t=e.responseText;try{var n=new Blob([t],{type:"plain/text"});return n.size}catch(e){return"string"==typeof t?t.length:0}},U=function(e,t){var n=e.url,a=i(n),u=r(a),s=u.host,c=u.urlPath,d=u.port,f=t.status,p=!1;(0===f||f>=400)&&(p=!0);var l;l=null!=e._startedTime?o(H()-e._startedTime):-1;var h={statusCode:f,reqLength:n.length,respLength:X(t),httpMethod:e.method,url:a,host:s,port:d,urlPath:c,error:p,errorDomain:void 0,errorDescription:p?t.responseText:void 0,requestId:e._requestId,elapsedTime:l};F(h)},N=function(e){var t,n=e.request,a=e.response,u=n.url,s=i(u),c=r(s),d=c.host,f=c.urlPath,p=c.port;if(t=n._startedTime?o(H()-n._startedTime):-1,null==a){var l={statusCode:-1,reqLength:-1,respLength:-1,httpMethod:-1,url:s,host:d,port:p,urlPath:f,error:!0,errorDomain:void 0,errorDescription:"Fetch API failed with no response",requestId:n._requestId,elapsedTime:t};return void F(l)}var h=a.status,v=!1;(0===h||h>=400)&&(v=!0),a.clone().blob().then(function(e){var r={statusCode:h,reqLength:u.length,respLength:e.size,httpMethod:n.method,url:s,host:d,port:p,urlPath:f,error:v,errorDomain:void 0,errorDescription:v?a.statusText:void 0,requestId:n._requestId,elapsedTime:t};F(r)})},B="function Headers() { [native code] }",G={load:!0,error:!0,event:!0,asset:!0,api:!1,etraceApiFilter:/(^\/)|(ele(net)?\.me)/},z=function(t){null!=t.appVer&&a(t.appVer),null!=t.sendingTypes&&e(G,t.sendingTypes),null!=t.trackerDomain&&u(t.trackerDomain),null!=t.etraceApiFilter&&(G.etraceApiFilter=t.etraceApiFilter)};null!=document.addEventListener&&(window.perf={send:s,version:b},null!=window.ElemePerfConfigs&&z(window.ElemePerfConfigs),G.error&&f(),G.load&&p(),G.event&&v(),G.asset&&y(),G.api&&w(G.etraceApiFilter))});
